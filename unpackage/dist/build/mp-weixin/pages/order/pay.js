(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/order/pay"],{"08bb":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=i(a("c6e9"));function i(t){return t&&t.__esModule?t:{default:t}}var n={name:"rattenking-dtpicker",props:{start:{type:String,default:"1900-00-00 00:00:00"},end:{type:String,default:"2500-12-30 23:59:59"},value:{type:String,default:""},fields:{type:String,default:"second"},disabled:{type:Boolean,default:!1}},data:function(){return{times:[["2019","2020"],["01","02"]],timesIndex:[1,1],timesString:null,curValue:this.value,curDisabled:this.disabled,cancel:null}},watch:{value:function(t){this.curValue=t},disabled:function(t){this.curDisabled=t},curDisabled:function(t){this.curDisabled=t},curValue:function(t){this.curValue=t,this.$emit("change",t)},times:function(t){this.times=t},timesIndex:function(t){this.timesIndex=t},cancel:function(t){this.$emit("cancel",t)}},created:function(){if(""===this.value){var t=r.default.getCurrentTimes(),e=[];for(var a in t.detail)if(e.push(t.detail[a]),a===this.fields)break;this.value=r.default.format(e),this.curValue=r.default.format(e)}switch(this.fields){case"year":if(4!==this.value.length)return r.default.error("时间粒度和时间格式不一致"),this.curDisabled=!0,!1;if(4!==this.start.length)return r.default.error("时间粒度和开始时间格式不一致"),this.curDisabled=!0,!1;if(4!==this.end.length)return r.default.error("时间粒度和结束时间格式不一致"),this.curDisabled=!0,!1;break;case"month":if(7!==this.value.length)return r.default.error("时间粒度和时间格式不一致"),this.curDisabled=!0,!1;if(7!==this.start.length)return r.default.error("时间粒度和开始时间格式不一致"),this.curDisabled=!0,!1;if(7!==this.end.length)return r.default.error("时间粒度和结束时间格式不一致"),this.curDisabled=!0,!1;break;case"day":if(10!==this.value.length)return r.default.error("时间粒度和时间格式不一致"),this.curDisabled=!0,!1;if(10!==this.start.length)return r.default.error("时间粒度和开始时间格式不一致"),this.curDisabled=!0,!1;if(10!==this.end.length)return r.default.error("时间粒度和结束时间格式不一致"),this.curDisabled=!0,!1;break;case"hour":if(13!==this.value.length)return r.default.error("时间粒度和时间格式不一致"),this.curDisabled=!0,!1;if(13!==this.start.length)return r.default.error("时间粒度和开始时间格式不一致"),this.curDisabled=!0,!1;if(13!==this.end.length)return r.default.error("时间粒度和结束时间格式不一致"),this.curDisabled=!0,!1;break;case"minute":if(16!==this.value.length)return r.default.error("时间粒度和时间格式不一致"),this.curDisabled=!0,!1;if(16!==this.start.length)return r.default.error("时间粒度和开始时间格式不一致"),this.curDisabled=!0,!1;if(16!==this.end.length)return r.default.error("时间粒度和结束时间格式不一致"),this.curDisabled=!0,!1;break;case"second":if(19!==this.value.length)return r.default.error("时间粒度和时间格式不一致"),this.curDisabled=!0,!1;if(19!==this.start.length)return r.default.error("时间粒度和开始时间格式不一致"),this.curDisabled=!0,!1;if(19!==this.end.length)return r.default.error("时间粒度和结束时间格式不一致"),this.curDisabled=!0,!1;break;default:r.default.error("时间粒度不存在");break}this.value.split(" ");var i=r.default.getCurrentStringValue(this.value);if(r.default.getTimes(this.value)<r.default.getTimes(this.start))return r.default.error("默认时间不能小于开始时间"),this.curDisabled=!0,!1;if(r.default.getTimes(this.value)>r.default.getTimes(this.end))return r.default.error("默认时间不能大于开始时间"),this.curDisabled=!0,!1;var n=r.default.getDateTimes({start:this.start.substring(0,4),end:this.end.substring(0,4),curyear:this.value.substring(0,4),curmonth:this.value.substring(5,7),fields:this.fields}),s=r.default.getTimeIndex(n,i),o=[];s.forEach(function(t){return o.push(t)}),this.times=n,this.timesIndex=s,this.timesString=o},methods:{changeDate:function(t){for(var e=t.detail.value,a=this.times,i=[],n=0,s=e.length;n<s;n++)i.push(a[n][e[n]]);var o=r.default.format(i);this.curValue=o},columnchangeDate:function(t){if("year"===this.fields||"month"===this.fields){var e=r.default.getNewArray(this.timesIndex);return e[t.detail.column]=t.detail.value,this.timesIndex=e,!1}if(0===t.detail.column||1===t.detail.column){var a=r.default.getNewArray(this.times),i=r.default.getNewArray(this.timesIndex);i[t.detail.column]=t.detail.value;var n=r.default.getMonthDay(a[0][i[0]],a[1][i[1]]);a[2]=n,i[2]>n.length-1&&(i[2]=n.length-1),this.times=a,this.timesIndex=i}else{var s=r.default.getNewArray(this.timesIndex);s[t.detail.column]=t.detail.value,this.timesIndex=s}},cancelDate:function(t){this.cancel=t}}};e.default=n},2851:function(t,e,a){"use strict";a("ba95");var r=n(a("b0ce")),i=n(a("5a48"));function n(t){return t&&t.__esModule?t:{default:t}}Page((0,r.default)(i.default))},"442d":function(t,e,a){},"5a48":function(t,e,a){"use strict";a.r(e);var r=a("ced6"),i=a("9a8b");for(var n in i)"default"!==n&&function(t){a.d(e,t,function(){return i[t]})}(n);a("bb15");var s=a("2877"),o=Object(s["a"])(i["default"],r["a"],r["b"],!1,null,null,null);e["default"]=o.exports},"91c2":function(t,e,a){"use strict";a.r(e);var r=a("9c68"),i=a("9c1f");for(var n in i)"default"!==n&&function(t){a.d(e,t,function(){return i[t]})}(n);a("f7ca");var s=a("2877"),o=Object(s["a"])(i["default"],r["a"],r["b"],!1,null,null,null);e["default"]=o.exports},"97c8":function(t,e,a){},"9a8b":function(t,e,a){"use strict";a.r(e);var r=a("f472"),i=a.n(r);for(var n in r)"default"!==n&&function(t){a.d(e,t,function(){return r[t]})}(n);e["default"]=i.a},"9c1f":function(t,e,a){"use strict";a.r(e);var r=a("08bb"),i=a.n(r);for(var n in r)"default"!==n&&function(t){a.d(e,t,function(){return r[t]})}(n);e["default"]=i.a},"9c68":function(t,e,a){"use strict";var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("picker",{staticClass:"rui-picker rui-class",attrs:{mode:"multiSelector",range:t.times,value:t.timesIndex,disabled:t.curDisabled,eventid:"1cb9829a-0"},on:{change:t.changeDate,cancel:t.cancelDate,columnchange:t.columnchangeDate}},[t._v(t._s(t.curValue))])},i=[];a.d(e,"a",function(){return r}),a.d(e,"b",function(){return i})},bb15:function(t,e,a){"use strict";var r=a("97c8"),i=a.n(r);i.a},c6e9:function(t,e,a){"use strict";function r(t){return s(t)||n(t)||i()}function i(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function n(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function s(t){if(Array.isArray(t)){for(var e=0,a=new Array(t.length);e<t.length;e++)a[e]=t[e];return a}}var o={withData:function(t){var e=parseInt(t);return e<10?"0"+e:""+e},getTimes:function(t){return new Date(t.replace(/-/g,"/")).getTime()},getCurrentTimes:function(){var t=new Date,e=t.getFullYear(),a=t.getMonth()+1,r=t.getDate(),i=t.getHours(),n=t.getMinutes(),s=t.getSeconds();return{detail:{year:e,month:a,day:r,hour:i,minute:n,second:s}}},format:function(t){var e=[],a=[],r="";return t.forEach(function(t,r){var i=o.withData(t);r>2?e.push(i):a.push(i)}),r=t.length<4?a.join("-"):a.join("-")+" "+e.join(":"),r},getCurrentStringValue:function(t){var e=t.split(" ");if(e&&e[1]){var a=[].concat(r(e[0].split("-")),r(e[1].split(":")));return a}return e[0].split("-")},getCompare:function(t,e,a,r){var i=o.getTimes(t),n=o.getTimes(e),s=o.getTimes(a);return i<n?o.getTimeIndex(r,o.getCurrentStringValue(e)):i>s?o.getTimeIndex(r,o.getCurrentStringValue(a)):o.getTimeIndex(r,o.getCurrentStringValue(t))},getChooseArr:function(t,e){var a=[];return t.forEach(function(t,r){return a.push(t[e[r]])}),a},getNewArray:function(t){var e=[];return t.forEach(function(t){return e.push(t)}),e},getLoopArray:function(t,e){t=t||0,e=e||1;for(var a=[],r=t;r<=e;r++)a.push(o.withData(r));return a},getMonthDay:function(t,e){var a=t%400==0||t%4==0&&t%100!=0,r=null;switch(e){case"01":case"03":case"05":case"07":case"08":case"10":case"12":r=o.getLoopArray(1,31);break;case"04":case"06":case"09":case"11":r=o.getLoopArray(1,30);break;case"02":r=a?o.getLoopArray(1,29):o.getLoopArray(1,28);break;default:r="月份格式不正确，请重新输入！"}return r},getDateTimes:function(t){var e=o.getLoopArray(t.start,t.end),a=o.getLoopArray(1,12),r=o.getMonthDay(t.curyear,t.curmonth),i=o.getLoopArray(0,23),n=o.getLoopArray(0,59),s=o.getLoopArray(0,59),c=null;switch(t.fields){case"year":c=[e];break;case"month":c=[e,a];break;case"day":c=[e,a,r];break;case"hour":c=[e,a,r,i];break;case"minute":c=[e,a,r,i,n];break;case"second":c=[e,a,r,i,n,s];break;default:c=[e,a,r,i,n,s]}return c},getIndex:function(t,e){for(var a=t.length,r=0;r<a;r++)if(t[r]==e)return r},getTimeIndex:function(t,e){for(var a=t.length,r=[],i=0;i<a;i++)r.push(o.getIndex(t[i],e[i]));return r},error:function(t){console.error(t)}};t.exports=o},ced6:function(t,e,a){"use strict";var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("view",{staticClass:"m-pay-page"},[a("view",{staticClass:"m-top-back"}),a("view",{staticClass:"m-top-map"},[a("view",{staticClass:"m-container"},[a("view",{staticClass:"m-title"},[t._v("到店自取")]),a("view",{staticClass:"m-content"},[a("view",{staticClass:"m-address"},[t._v(t._s(t.storeData.address))]),a("m-map",{attrs:{latitude:t.storeData.lat,longitude:t.storeData.lng,userlat:t.latitude,userlng:t.longitude,distance:t.geoDistance(t.latitude,t.longitude,t.storeData.lat,t.storeData.lng),mpcomid:"4d5cf31c-0"}}),a("view",{staticClass:"m-footer"},[a("view",{staticClass:"m-item"},[a("view",{staticClass:"m-text"},[t._v("自取时间")]),a("view",{staticClass:"m-light"},[a("ruiDatePicker",{attrs:{fields:"minute",start:t.today,end:"2030-12-30 23:59",value:t.aboutPickingTime,eventid:"4d5cf31c-0",mpcomid:"4d5cf31c-1"},on:{change:t.bindChange,cancel:t.bindCancel}})],1)]),a("view",{staticClass:"m-item"},[a("view",{staticClass:"m-text"},[t._v("预留电话")]),a("view",{staticClass:"m-light"},[a("input",{attrs:{type:"text",value:t.reserveTel}})])])])],1)])]),a("view",{staticClass:"m-pro-container"},t._l(t.shopCarList,function(t,e){return a("m-order-pro",{key:t.id,attrs:{title:t.synopsis,price:t.presentPrice,oldprice:t.originalPrice,imgurl:t.pictureUrl,num:t.buyCount,mpcomid:"4d5cf31c-2-"+e}})})),a("view",{staticClass:"m-pro-message"},[a("view",{staticClass:"m-row"},[a("view",{staticClass:"m-label"},[t._v("商品原价")]),a("view",{staticClass:"m-price"},[t._v("¥"+t._s(t.totalPrice))])]),a("view",{staticClass:"m-row"},[a("view",{staticClass:"m-label"},[t._v("商品折扣")]),a("view",{staticClass:"m-discount"},[t._v("-¥"+t._s(t.discount))])]),a("view",{staticClass:"m-row"},[a("view",{staticClass:"m-label"},[t._v("商品优惠")]),a("view",{staticClass:"m-discount"},[t._v("-¥"+t._s(t.yhPrice))])]),a("view",{staticClass:"m-row"},[a("view",{staticClass:"m-label"},[t._v("优惠券抵用")]),a("view",{staticClass:"m-discount"},[t._v("-¥"+t._s(t.couponPrice))])]),a("view",{staticClass:"m-row"},[a("view",{staticClass:"m-label"},[t._v("优惠券")]),t.haveTokenCard?a("view",{staticClass:"m-token active",attrs:{eventid:"4d5cf31c-1"},on:{tap:t.choseTokenFn}},[t._v("选择优惠券>")]):a("view",{staticClass:"m-token"},[t._v("暂无可用>")])]),a("view",{staticClass:"m-footer"},[t._v("合计"),a("view",{staticClass:"count"},[t._v("￥"+t._s(t.payPrice))])])]),a("view",{staticClass:"m-paytype"},[a("view",{staticClass:"m-title"},[t._v("支付方式")]),a("view",{staticClass:"m-row"},[t._m(0),a("view",{staticClass:"m-radio",attrs:{eventid:"4d5cf31c-2"},on:{tap:function(e){t.paytypeFn("wx")}}},["wx"==t.paytype?a("image",{staticStyle:{width:"34rpx",height:"30rpx"},attrs:{src:"../../static/img/icon/pay_icon_ok.png",mode:"aspectFit"}}):a("image",{staticStyle:{width:"34rpx",height:"30rpx"},attrs:{src:"../../static/img/icon/pay_icon_ok2.png",mode:"aspectFit"}})])])]),a("view",{staticClass:"place"}),a("view",{staticClass:"m-footer-but",attrs:{eventid:"4d5cf31c-3"},on:{tap:t.payFn}},[t._v("立即支付￥"+t._s(t.payPrice))])])},i=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("view",{staticClass:"m-icon"},[a("image",{staticStyle:{width:"34rpx",height:"30rpx"},attrs:{src:"../../static/img/icon/pay_wx_icon.png",mode:"aspectFit"}}),a("view",{staticClass:"m-text"},[t._v("微信支付")])])}];a.d(e,"a",function(){return r}),a.d(e,"b",function(){return i})},f472:function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=o(a("d5ef")),i=o(a("df44")),n=o(a("ecb9")),s=o(a("91c2"));function o(t){return t&&t.__esModule?t:{default:t}}function c(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{},r=Object.keys(a);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter(function(t){return Object.getOwnPropertyDescriptor(a,t).enumerable}))),r.forEach(function(e){u(t,e,a[e])})}return t}function u(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function l(t,e){var a={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};for(var r in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length))),a)new RegExp("("+r+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?a[r]:("00"+a[r]).substr((""+a[r]).length)));return t}var d={components:{mMap:i.default,mOrderPro:n.default,ruiDatePicker:s.default},data:function(){return{storeid:"",storeData:{},distance:"",today:l("yyyy-MM-dd hh:mm",new Date),aboutPickingTime:l("yyyy-MM-dd hh:mm",new Date),reserveTel:"17600802360",paytype:"wx",type:"",latitude:39.909,longitude:116.39742,shopCarList:[],totalCount:0,totalPrice:"",couponPrice:"",yhPrice:"",discount:0,payPrice:0,couponId:0,haveTokenCard:!1}},methods:{choseTokenFn:function(){t.navigateTo({url:"/pages/order/tokens?storeid="+this.storeid})},paytypeFn:function(t){this.paytype=t},getData:function(t){var e=this,a=decodeURI(t.proUrlData);e.shopCarList=JSON.parse(a)["proUrlData"],e.orderInit()},tokenCard:function(){var t=this;t.mPost("/server/co/usableCoupons",{storeId:t.storeid,start:1,length:1e3}).then(function(e){1==e.code&&e.data.coupons&&e.data.coupons.length>0&&(t.haveTokenCard=!0)})},orderInit:function(){var t=this,e={storeId:t.storeid,totalCount:t.totalCount,type:t.type,products:t.shopCarList,couponId:t.couponId};t.mPost("/server/pay/calOrderPrice",e).then(function(e){if("1"==e.code){var a=e.data;t.totalPrice=a.totalPrice,t.couponPrice=a.couponPrice,t.yhPrice=a.yhPrice,t.discount=a.discount,t.payPrice=a.payPrice}})},payFn:function(){var e=this,a=e.shopCarList.map(function(t){return{productId:t.id,cou:t.buyCount}}),r={storeId:e.storeid,totalCount:e.totalCount,type:e.type,couponId:e.couponId,aboutPickingTime:e.aboutPickingTime?e.aboutPickingTime+":00":"",reserveTel:e.reserveTel,products:a};e.couponId&&(r["couponId"]=this.couponId),e.outTradeNo&&(r["outTradeNo"]=this.outTradeNo),e.mPost("/server/pay/wxpay",r).then(function(e){if(1==e.code){var a=e.data,r=(a.prepay_id,{provider:"wxpay",timeStamp:a.timeStamp+"",nonceStr:a.nonceStr,package:a.package,signType:a.signType,paySign:a.paySign});t.requestPayment(c({},r,{success:function(e){t.showModal({title:"支付成功",content:"可在我的订单中查看详情",showCancel:!1,confirmText:"查看订单",success:function(e){e.confirm?(t.setStorageSync("orderTab",1),t.switchTab({url:"/pages/tabBar/order"})):e.cancel&&console.log("用户点击取消")}})},fail:function(e){t.setStorageSync("orderTab",2),t.switchTab({url:"/pages/tabBar/order"})}}))}})},clearShopcar:function(){var t=this;t.mPost("/server/sc/delete/all",{}).then(function(e){"1"==e.code&&(console.log("这里"),t.shopCarList=[],t.shopCarCountClear(),t.hideSpec())})},storeDetail:function(){var t=this;this.mPost("/server/s/storeById",{id:this.storeid}).then(function(e){t.storeData=e.data,console.log(e)}).catch(function(t){console.log(t)})},storeLocation:function(){var e=this;t.getLocation({type:"gcj02",success:function(t){e.latitude=t.latitude,e.longitude=t.longitude}})},UPDATA_TOKEN:function(t){this.couponId=t.id,this.getData()}},onLoad:function(t){console.log(111111),this.couponId=t.couponId||"",this.storeid=t.storeid,this.totalCount=t.totalCount,this.type=t.type,this.storeLocation(),this.storeDetail(),this.getData(t),this.tokenCard(),r.default.addNoticeFun(r.default.UPDATA_TOKEN,"UPDATA_TOKEN",this)},onUnload:function(){r.default.removeNoticeFun(r.default.UPDATA_TOKEN)}};e.default=d}).call(this,a("543d")["default"])},f7ca:function(t,e,a){"use strict";var r=a("442d"),i=a.n(r);i.a}},[["2851","common/runtime","common/vendor"]]]);