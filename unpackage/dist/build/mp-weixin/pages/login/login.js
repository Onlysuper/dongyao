(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/login/login"],{"094e":function(t,e,n){"use strict";n.r(e);var i=n("7eac"),a=n("752c");for(var o in a)"default"!==o&&function(t){n.d(e,t,function(){return a[t]})}(o);n("f344");var r=n("2877"),u=Object(r["a"])(a["default"],i["a"],i["b"],!1,null,null,null);e["default"]=u.exports},"2b3f":function(t,e,n){"use strict";n("ba95");var i=o(n("b0ce")),a=o(n("094e"));function o(t){return t&&t.__esModule?t:{default:t}}Page((0,i.default)(a.default))},3853:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=a(n("a34a"));function a(t){return t&&t.__esModule?t:{default:t}}function o(t,e,n,i,a,o,r){try{var u=t[o](r),s=u.value}catch(c){return void n(c)}u.done?e(s):Promise.resolve(s).then(i,a)}function r(t){return function(){var e=this,n=arguments;return new Promise(function(i,a){var r=t.apply(e,n);function u(t){o(r,i,a,u,s,"next",t)}function s(t){o(r,i,a,u,s,"throw",t)}u(void 0)})}}var u={data:function(){return{SessionKey:"",OpenId:"",nickName:null,avatarUrl:null,isCanUse:t.getStorageSync("isCanUse")||!0,needAllow:!0}},methods:{register:function(){t.switchTab({url:"/pages/login/register"})},saveCode:function(){var e=r(i.default.mark(function e(){var n;return i.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=this,t.showLoading({title:"登录中..."}),e.next=4,t.login({provider:"weixin",success:function(e){var i=e.code;n.mPost("/auth/wxLogin",i,"https://dy.gantangerbus.com/da").then(function(e){if(e.data){var i=e.data;if(i.isRegister){var a=i;n.needAllow=!1,t.setStorageSync("userData",JSON.stringify(a.userInfo)),t.setStorageSync("phone",a.userInfo.mobile),t.setStorageSync("Authorization",a.authToken),t.showToast({title:"授权成功",icon:"none"}),setTimeout(function(){t.switchTab({url:"/pages/tabBar/home"})},1300)}}t.hideLoading()}).catch(function(e){t.hideLoading()})}});case 4:case"end":return e.stop()}},e,this)}));function n(){return e.apply(this,arguments)}return n}(),getuserinfo:function(e){t.getStorageSync("Authorization")||this.saveCode();var n=this;if(!e.detail.iv)return t.showToast({title:"您取消了授权,登录失败",icon:"none"}),!1;t.showLoading({}),t.getUserInfo({provider:"weixin",success:function(e){t.setStorageSync("userData",JSON.stringify(e.userInfo)),t.showLoading({}),n.mPost("/auth/wxUserInfo",e.userInfo,"https://dy.gantangerbus.com/da").then(function(e){t.navigateTo({url:"/pages/login/register"}),t.hideLoading()}).catch(function(e){t.hideLoading()})},fail:function(e){t.hideLoading()}})}},onLoad:function(){this.saveCode()}};e.default=u}).call(this,n("543d")["default"])},"56a7":function(t,e,n){},"752c":function(t,e,n){"use strict";n.r(e);var i=n("3853"),a=n.n(i);for(var o in i)"default"!==o&&function(t){n.d(e,t,function(){return i[t]})}(o);e["default"]=a.a},"7eac":function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("view",{staticClass:"m-login-page"},[n("view",{staticClass:"m-img-box"},[t._v("千畔优品")]),n("view",{staticClass:"describe"},[t._v("您暂未授权'千畔优品'小程序获取你的信息，讲无法正常使用小程序的功能。\n\t\t如果需要正常使用，请点击\"授权\"按钮，打开头像，昵称等信息的权限")]),n("view",{staticClass:"m-but"},[n("button",{attrs:{disabled:!t.needAllow,type:"primary","open-type":"getUserInfo",withCredentials:"true",eventid:"8ff3bae4-0"},on:{getuserinfo:t.getuserinfo}},[t._v("授权")])],1)])},a=[];n.d(e,"a",function(){return i}),n.d(e,"b",function(){return a})},f344:function(t,e,n){"use strict";var i=n("56a7"),a=n.n(i);a.a}},[["2b3f","common/runtime","common/vendor"]]]);