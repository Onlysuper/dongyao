(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/store/store"],{"13e9":function(t,e,i){"use strict";i.r(e);var s=i("c847"),n=i.n(s);for(var a in s)"default"!==a&&function(t){i.d(e,t,function(){return s[t]})}(a);e["default"]=n.a},1843:function(t,e,i){"use strict";var s=i("747d"),n=i.n(s);n.a},"1ee4":function(t,e,i){"use strict";var s=i("f221"),n=i.n(s);n.a},"273e":function(t,e,i){"use strict";var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("view",{staticClass:"m-footer-car"},[i("view",{staticClass:"m-icon",attrs:{eventid:"44b39ef1-0"},on:{tap:t.handleFn}},[i("view",{staticClass:"m-num"},[t._v(t._s(t.num))]),i("image",{staticStyle:{width:"120rpx",height:"120rpx"},attrs:{src:"../../static/img/icon/shop_button_buy.png",mode:"aspectFit"}})]),i("view",{staticClass:"m-price"},[t._v(t._s(t.price))]),i("view",{staticClass:"m-but",attrs:{eventid:"44b39ef1-1"},on:{tap:t.payFn}},[t._v(t._s(t.title))])])},n=[];i.d(e,"a",function(){return s}),i.d(e,"b",function(){return n})},"2c63":function(t,e,i){"use strict";i.r(e);var s=i("95d3"),n=i("60ac");for(var a in n)"default"!==a&&function(t){i.d(e,t,function(){return n[t]})}(a);i("1843");var r=i("2877"),o=Object(r["a"])(n["default"],s["a"],s["b"],!1,null,null,null);e["default"]=o.exports},"387b":function(t,e,i){"use strict";var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("view",{staticClass:"m-store-store"},[i("view",{staticClass:"m-store-banner"},[i("view",{staticClass:"m-content"},[i("view",{staticClass:"m-message"},[i("view",{staticClass:"m-img"},[i("image",{staticStyle:{width:"100%",height:"100%"},attrs:{src:t.storeData.imgUrl,mode:"aspectFit"}})]),i("view",{staticClass:"m-body"},[i("view",{staticClass:"m-text-box"},[i("view",{staticClass:"m-title"},[t._v(t._s(t.storeData.name))]),i("view",{staticClass:"m-text"},[t._v(t._s(t.storeData.notice))]),i("view",{staticClass:"m-time"},[t._v("营业："+t._s(t.storeData.businessHours))])]),i("view",{staticClass:"m-phone",attrs:{eventid:"05dd8904-0"},on:{tap:function(e){t.callPhone(t.storeData.tel)}}},[i("image",{staticStyle:{width:"40rpx",height:"40rpx","margin-left":"20rpx"},attrs:{src:"../../static/img/icon/shop_icon_phone.png",mode:"aspectFit"}})])])])])]),i("view",{staticClass:"category-list"},[i("scroll-view",{staticClass:"left",attrs:{"scroll-y":"true"}},t._l(t.storeMenu,function(e,s){return i("view",{key:e.id,staticClass:"row",class:[e.id==t.typeid?"on":""],attrs:{eventid:"05dd8904-1-"+s},on:{tap:function(i){t.checkType(e.id)}}},[i("view",{staticClass:"text"},[i("view",{staticClass:"block"}),t._v(t._s(e.name))])])})),i("scroll-view",{staticClass:"right",attrs:{"scroll-y":"true","scroll-top":t.scrollTop,eventid:"05dd8904-3"},on:{scrolltoupper:t.upper,scrolltolower:t.loadMore,scroll:t.scroll}},[i("view",{staticClass:"category"},[i("view",{staticClass:"list"},[t._l(t.productList,function(e,s){return i("view",{key:e.id,staticClass:"box"},[i("m-store-pro",{attrs:{rowData:e,pictureUrl:e.pictureUrl,isAssemble:e.isAssemble,synopsis:e.synopsis,labelName:e.labelName,presentPrice:e.presentPrice,originalPrice:e.originalPrice,isadd:e.isadd,eventid:"05dd8904-2-"+s,mpcomid:"05dd8904-0-"+s},on:{proDetail:t.proDetail,touchOnGoods:t.touchOnGoods}})],1)}),i("view",{staticClass:"no-more-text"},[t._v("~去看看其他分类吧~")])],2)])])],1),i("m-footer-car",{attrs:{title:"去结算",price:t.shopCarListPrice,num:t.shopCarListLength,eventid:"05dd8904-4",mpcomid:"05dd8904-1"},on:{handleFn:function(e){t.showSpec(!1)},payFn:t.payFn}}),i("view",{staticClass:"popup spec",class:t.specClass,attrs:{eventid:"05dd8904-9"},on:{touchmove:function(e){e.stopPropagation(),e.preventDefault(),t.discard(e)},tap:t.hideSpec}},[i("view",{staticClass:"mask"}),i("view",{staticClass:"layer",attrs:{eventid:"05dd8904-8"},on:{tap:function(e){e.stopPropagation(),t.discard(e)}}},[i("view",{staticClass:"m-shopcar-box"},[i("view",{staticClass:"m-header"},[i("view",{staticClass:"m-line"},[i("view",{},[t._v("购物车")]),i("view",{staticClass:"m-light"},[t._v("共"+t._s(t.shopCarListLength)+"件商品")])]),i("view",{staticClass:"m-clear-car",attrs:{eventid:"05dd8904-5"},on:{tap:t.clearShopcar}},[t._v("清空购物车")])]),t._l(t.shopCarList,function(e,s){return i("view",{key:s,staticClass:"m-shopcar-item"},[i("view",{staticClass:"m-title"},[t._v(t._s(e.synopsis))]),i("view",{staticClass:"m-price"},[t._v("￥"+t._s(e.presentPrice))]),i("view",{staticClass:"m-controne"},[i("uni-number-box",{attrs:{value:e.buyCount,min:0,max:e.stock,id:e.id,eventid:"05dd8904-6-"+s,mpcomid:"05dd8904-2-"+s},on:{change:t.buyNumChange}})],1)])})],2),i("m-footer-car",{attrs:{title:"去结算",price:t.shopCarListPrice,num:t.shopCarListLength,eventid:"05dd8904-7",mpcomid:"05dd8904-3"},on:{handleFn:function(e){t.showSpec(!1)},payFn:t.payFn}})],1)]),i("view",{directives:[{name:"show",rawName:"v-show",value:!t.hide_good_box,expression:"!hide_good_box"}],staticClass:"good_box",style:"left:"+t.bus_x+"px;top:"+t.bus_y+"px"})],1)},n=[];i.d(e,"a",function(){return s}),i.d(e,"b",function(){return n})},"39b0":function(t,e,i){"use strict";i.r(e);var s=i("f3bd"),n=i("647e");for(var a in n)"default"!==a&&function(t){i.d(e,t,function(){return n[t]})}(a);i("1ee4");var r=i("2877"),o=Object(r["a"])(n["default"],s["a"],s["b"],!1,null,null,null);e["default"]=o.exports},5632:function(t,e,i){"use strict";i.r(e);var s=i("273e"),n=i("d9b1");for(var a in n)"default"!==a&&function(t){i.d(e,t,function(){return n[t]})}(a);i("5bfd");var r=i("2877"),o=Object(r["a"])(n["default"],s["a"],s["b"],!1,null,null,null);e["default"]=o.exports},"5bfd":function(t,e,i){"use strict";var s=i("eade"),n=i.n(s);n.a},"60ac":function(t,e,i){"use strict";i.r(e);var s=i("850a"),n=i.n(s);for(var a in s)"default"!==a&&function(t){i.d(e,t,function(){return s[t]})}(a);e["default"]=n.a},"647e":function(t,e,i){"use strict";i.r(e);var s=i("9fa2"),n=i.n(s);for(var a in s)"default"!==a&&function(t){i.d(e,t,function(){return s[t]})}(a);e["default"]=n.a},"747d":function(t,e,i){},"850a":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s={name:"m-store-pro",props:{rowData:{type:Object,rowData:{}},pictureUrl:{type:[String,Number],default:""},isAssemble:{type:[String,Number],default:""},synopsis:{type:[String,Number],default:""},labelNames:{type:[String,Number],default:""},presentPrice:{type:[String,Number],default:""},originalPrice:{type:[String,Number],default:""},isadd:{type:[String,Number],default:""}},methods:{proDetail:function(t){this.$emit("proDetail",this.rowData)},touchOnGoods:function(t){this.$emit("touchOnGoods",{data:this.rowData,elem:t})}},data:function(){return{isAdd:!1}}};e.default=s},9041:function(t,e,i){"use strict";i.r(e);var s=i("387b"),n=i("13e9");for(var a in n)"default"!==a&&function(t){i.d(e,t,function(){return n[t]})}(a);i("ba7a");var r=i("2877"),o=Object(r["a"])(n["default"],s["a"],s["b"],!1,null,null,null);e["default"]=o.exports},"95d3":function(t,e,i){"use strict";var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("view",{staticClass:"m-store-item"},[i("view",{staticClass:"m-img",attrs:{eventid:"6c868792-0"},on:{tap:t.proDetail}},[i("image",{staticStyle:{width:"100%",height:"100%","border-radius":"100%"},attrs:{src:t.pictureUrl,mode:"aspectFill"}}),1==t.isAssemble?i("view",{staticClass:"m-pin"},[t._v("可拼团")]):t._e()]),i("view",{staticClass:"m-text"},[i("view",{staticClass:"m-title",attrs:{eventid:"6c868792-1"},on:{tap:t.proDetail}},[t._v(t._s(t.synopsis))]),i("view",{staticClass:"m-descripe",attrs:{eventid:"6c868792-2"},on:{tap:t.proDetail}},[t._v(t._s(t.labelName))]),i("view",{staticClass:"m-price",attrs:{eventid:"6c868792-3"},on:{tap:t.proDetail}},[t._v(t._s(t.presentPrice))]),i("view",{staticClass:"m-old-price",attrs:{eventid:"6c868792-4"},on:{tap:t.proDetail}},[t._v("非会员价"),i("view",{staticClass:"m-num"},[t._v(t._s(t.originalPrice))])])]),i("view",{staticClass:"m-distance"},[t.isAdd?i("image",{staticStyle:{width:"40rpx",height:"40rpx"},attrs:{src:"../../static/img/icon/shop_icon_buy_chose.png",mode:"aspectFit",eventid:"6c868792-5"},on:{tap:t.touchOnGoods}}):i("image",{staticStyle:{width:"40rpx",height:"40rpx"},attrs:{src:"../../static/img/icon/shop_icon_buy.png",mode:"aspectFit",eventid:"6c868792-6"},on:{tap:t.touchOnGoods}})])])},n=[];i.d(e,"a",function(){return s}),i.d(e,"b",function(){return n})},"9b8d":function(t,e,i){},"9fa2":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s={name:"uni-number-box",props:{id:{type:[Number,String],default:1},value:{type:Number,default:1},min:{type:Number,default:0},max:{type:Number,default:100},step:{type:Number,default:1},disabled:{type:Boolean,default:!1}},data:function(){return{inputValue:this.value}},computed:{disableSubtract:function(){return this.inputValue<=this.min},disableAdd:function(){return this.inputValue>=this.max}},watch:{value:function(t){this.inputValue=t}},methods:{_calcValue:function(t){if(!this.disabled){var e=this._getDecimalScale(),i=this.inputValue*e,s=this.step*e;"subtract"===t?i-=s:"add"===t&&(i+=s),i<this.min||i>this.max||(this.inputValue=i/e,this.$emit("change",{num:this.inputValue,id:this.id}))}},_getDecimalScale:function(){var t=1;return~~this.step!==this.step&&(t=Math.pow(10,(this.step+"").split(".")[1].length)),t},_onBlur:function(t){var e=t.detail.value;e?(e=+e,1*e>1*this.max?(console.log("这里快点"+this.max),e=this.max):1*e<1*this.min&&(e=this.min),this.inputValue=e+"",this.$emit("change",{num:1*this.inputValue,id:this.id})):this.inputValue=0}}};e.default=s},a2ce:function(t,e,i){"use strict";i("ba95");var s=a(i("b0ce")),n=a(i("9041"));function a(t){return t&&t.__esModule?t:{default:t}}Page((0,s.default)(n.default))},b48d:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s={name:"m-footer-car",props:{title:{type:String,value:""},price:{type:String,value:""},num:{type:String,value:""}},data:function(){return{}},methods:{handleFn:function(){this.$emit("handleFn")},payFn:function(){this.$emit("payFn")}}};e.default=s},ba7a:function(t,e,i){"use strict";var s=i("9b8d"),n=i.n(s);n.a},c847:function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=r(i("5632")),n=r(i("2c63")),a=r(i("39b0"));function r(t){return t&&t.__esModule?t:{default:t}}function o(t){return l(t)||u(t)||c()}function c(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function u(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function l(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}function d(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},s=Object.keys(i);"function"===typeof Object.getOwnPropertySymbols&&(s=s.concat(Object.getOwnPropertySymbols(i).filter(function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable}))),s.forEach(function(e){p(t,e,i[e])})}return t}function p(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var h=1,f=0;function v(t,e){for(var i,s,n,a=[],r=0;r<=e;r++){n=t.slice(0),s=[];while(i=n.shift())if(n.length)s.push(o([i,n[0]],r/e));else{if(!(s.length>1))break;n=s,s=[]}a.push(s[0])}function o(t,e){var i,s,n,a,r,o,c,u,l=[];return i=t[0],s=t[1],a=s.x-i.x,r=s.y-i.y,n=Math.pow(Math.pow(a,2)+Math.pow(r,2),.5),o=r/a,c=Math.atan(o),u=n*e,l={x:i.x+u*Math.cos(c),y:i.y+u*Math.sin(c)},l}return{bezier_points:a}}var m={components:{mStorePro:n.default,uniNumberBox:a.default,mFooterCar:s.default},data:function(){return{typeid:1,scrollTop:0,shopCarList:[],shopCarListLength:0,shopCarListPrice:0,storeid:0,storeData:{},hide_good_box:!0,bus_x:0,bus_y:0,finger:{},busPos:{},linePos:[],timer:null,carPrice:"10",specClass:"",storeMenu:[{id:1,title:"家用电器",banner:"../../static/img/category/banner.jpg",list:[{name:"精品秋葵600g",descripe:"脆糯营养，口感好，健康绿色",img:"../../static/img/1.jpg",price:"￥9.99",oldprice:"￥9.99"}]}],productList:[]}},computed:{},methods:{proDetail:function(e){t.navigateTo({url:"/pages/product/product?id="+e.id})},callPhone:function(e){t.makePhoneCall({phoneNumber:e})},payFn:function(){var e=1,i=0,s=this.shopCarList.map(function(t,e,s){var n=d({},t);return n["describes"]="",i+=n.buyCount,n}),n=encodeURI(JSON.stringify({proUrlData:s}));t.navigateTo({url:"/pages/order/pay?storeid="+this.storeid+"&totalCount="+i+"&type="+e+"&userid="+this.userid+"&proUrlData="+n})},halfWidth:function(t){return 2*t+"px"},touchOnGoods:function(t){var e=t.elem,i=t.data;this.timer&&clearInterval(this.timer),this.finger={};var s={};this.finger["x"]=e.target.x,this.finger["y"]=e.target.y,this.finger["y"]<this.busPos["y"]?s["y"]=this.finger["y"]-150:s["y"]=this.busPos["y"]-150,s["x"]=Math.abs(this.finger["x"]-this.busPos["x"])/2,this.finger["x"]>this.busPos["x"]?s["x"]=(this.finger["x"]-this.busPos["x"])/2+this.busPos["x"]:s["x"]=(this.busPos["x"]-this.finger["x"])/2+this.finger["x"],this.linePos=v([this.busPos,s,this.finger],30),this.startAnimation(e,i)},startAnimation:function(t,e){var i=0,s=this,n=s.linePos["bezier_points"];s.hide_good_box=!1,s.bus_x=s.finger["x"],s.bus_y=s.finger["y"];var a=n.length;i=a,s.timer=setInterval(function(){i--,s.bus_x=n[i]["x"],s.bus_y=n[i]["y"],i<1&&(clearInterval(s.timer),s.hide_good_box=!0,s.addGoodSum(e,1,"add"))},25)},showCategory:function(){var e=this;t.showLoading({}),f&&h>f?t.hideLoading():this.mPost("/server/p/search/products",{start:h,length:10,typeId:this.typeid,storeId:this.storeId}).then(function(i){if("1"==i.code&&i.data&&i.data.list){var s=i.data;f=s.pages;var n=s.list;e.productList=e.productList.concat(n),e.showShopCar(),t.hideLoading(),h++}}).catch(function(e){t.hideLoading()})},showShopCar:function(){var t=this,e=this;this.mPost("/server/sc/find/cart",{}).then(function(i){if("1"==i.code&&i.data){var s=o(i.data);s=s.map(function(i){var s=i.id;t.productLis=t.productLis;var n=0;return-1!=e.productList.findIndex(function(t){return t.id==s})&&e.productList.find(function(t){return t.id==s})["stock"]["stock"]&&(n=e.productList.find(function(t){return t.id==s})["stock"]),d({stock:n},i)}),e.shopCarList=s,e.shopCarCount()}})},clearShopcar:function(){var t=this;t.mPost("/server/sc/delete/all",{}).then(function(e){t.shopCarList=[],t.shopCarCountClear(),t.hideSpec()})},hideSpec:function(){var t=this;this.specClass="hide",this.selectSpec&&this.specCallback&&this.specCallback(),this.specCallback=!1,setTimeout(function(){t.specClass="none"},200)},showSpec:function(t){this.specClass="show",this.specCallback=t},specCallback:function(){},goDetail:function(e){t.navigateTo({url:"/pages/product/product"})},discard:function(){},busHandle:function(){var t=0,e=this;e.busPos["x"]=45,wx.getSystemInfo({success:function(i){t=i.windowHeight,e.busPos["y"]=t-56}})},addGoodSum:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments.length>2?arguments[2]:void 0,n=e.id,a=this.productList.find(function(t){return t.id==n}),r=this,o=i,c=this.shopCarList.findIndex(function(t){return t.id==n});-1!=c&&"add"==s&&(console.log(),o=this.shopCarList.find(function(t){return t.id==n})["buyCount"]+1),o>a.stock&&(t.showToast({title:"库存不足",icon:"none"}),o=a.stock),r.mPost("/server/sc/add/product",{productId:a.id,buyCount:o}).then(function(t){1==t.code&&r.showShopCar()}).catch(function(e){t.showToast({title:"操作失败，请检查网络",icon:"none"})})},buyNumChange:function(t){var e=t.num;this.addGoodSum(t,e,"change")},shopCarCount:function(){var t=this,e=0,i=this.shopCarList.map(function(t,i,s){var n={};return n.productId=t.id,n.cou=t.buyCount,e+=t.buyCount,n});i=JSON.stringify(i),t.mPost("/server/p/calProductsPrice",i).then(function(i){1==i.code&&(t.shopCarListPrice=i.data.totalPrice,t.shopCarListLength=e),console.log(i)}).catch(function(t){console.log(t)})},shopCarCountClear:function(){this.shopCarListLength=0,this.shopCarListPrice=0},loadMore:function(t){this.showCategory()},initProducts:function(){h=1,f=0,this.productList=[],this.showCategory()},checkType:function(t){h=1,f=0,this.typeid=t,this.productList=[],this.showCategory()},initTypes:function(){var t=this;this.mPost("/server/t/types",{}).then(function(e){"1"==e.code&&(t.storeMenu=e.data)})},initBusiness:function(){var t=this,e=this;this.mPost("/server/s/storeById",{id:e.storeid}).then(function(e){"1"==e.code&&(t.storeData=e.data)})}},onLoad:function(t){this.storeid=t.storeid,this.typeid=t.typeid||1,this.busHandle(),this.initBusiness(),this.initTypes(),this.initProducts()},onPullDownRefresh:function(){}};e.default=m}).call(this,i("543d")["default"])},d9b1:function(t,e,i){"use strict";i.r(e);var s=i("b48d"),n=i.n(s);for(var a in s)"default"!==a&&function(t){i.d(e,t,function(){return s[t]})}(a);e["default"]=n.a},eade:function(t,e,i){},f221:function(t,e,i){},f3bd:function(t,e,i){"use strict";var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("view",{staticClass:"uni-numbox"},[i("view",{staticClass:"uni-numbox__minus",class:{"uni-numbox--disabled":t.disableSubtract||t.disabled},attrs:{eventid:"443d2f40-0"},on:{click:function(e){t._calcValue("subtract")}}},[t._v("-")]),i("input",{staticClass:"uni-numbox__value",attrs:{type:"number",disabled:t.disabled,value:t.inputValue,eventid:"443d2f40-1"},on:{blur:t._onBlur}}),i("view",{staticClass:"uni-numbox__plus",class:{"uni-numbox--disabled":t.disableAdd||t.disabled},attrs:{eventid:"443d2f40-2"},on:{click:function(e){t._calcValue("add")}}},[t._v("+")])])},n=[];i.d(e,"a",function(){return s}),i.d(e,"b",function(){return n})}},[["a2ce","common/runtime","common/vendor"]]]);